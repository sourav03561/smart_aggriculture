-- Query to calculate average, maximum, and minimum values for each sensor type (temperature, humidity, pH, N, P, K) for each land within a specified date range
SELECT 
    sd.land_id, 
    AVG(CASE WHEN st.typename = 'Temperature' THEN sd.value ELSE NULL END) AS avg_temperature,
    MAX(CASE WHEN st.typename = 'Temperature' THEN sd.value ELSE NULL END) AS max_temperature,
    MIN(CASE WHEN st.typename = 'Temperature' THEN sd.value ELSE NULL END) AS min_temperature,
    AVG(CASE WHEN st.typename = 'Humidity' THEN sd.value ELSE NULL END) AS avg_humidity,
    MAX(CASE WHEN st.typename = 'Humidity' THEN sd.value ELSE NULL END) AS max_humidity,
    MIN(CASE WHEN st.typename = 'Humidity' THEN sd.value ELSE NULL END) AS min_humidity,
    AVG(CASE WHEN st.typename = 'PH' THEN sd.value ELSE NULL END) AS avg_ph,
    MAX(CASE WHEN st.typename = 'PH' THEN sd.value ELSE NULL END) AS max_ph,
    MIN(CASE WHEN st.typename = 'PH' THEN sd.value ELSE NULL END) AS min_ph,
    AVG(CASE WHEN st.typename = 'N' THEN sd.value ELSE NULL END) AS avg_nitrogen,
    MAX(CASE WHEN st.typename = 'N' THEN sd.value ELSE NULL END) AS max_nitrogen,
    MIN(CASE WHEN st.typename = 'N' THEN sd.value ELSE NULL END) AS min_nitrogen,
    AVG(CASE WHEN st.typename = 'P' THEN sd.value ELSE NULL END) AS avg_phosphorus,
    MAX(CASE WHEN st.typename = 'P' THEN sd.value ELSE NULL END) AS max_phosphorus,
    MIN(CASE WHEN st.typename = 'P' THEN sd.value ELSE NULL END) AS min_phosphorus,
    AVG(CASE WHEN st.typename = 'K' THEN sd.value ELSE NULL END) AS avg_potassium,
    MAX(CASE WHEN st.typename = 'K' THEN sd.value ELSE NULL END) AS max_potassium,
    MIN(CASE WHEN st.typename = 'K' THEN sd.value ELSE NULL END) AS min_potassium
FROM 
    Sensor_Data sd
INNER JOIN 
    Sensors s ON sd.sensor_id = s.sensor_id
INNER JOIN 
    Sensor_Type st ON s.sensor_typeid = st.sensor_typeid
WHERE 
    sd.date BETWEEN [Start_Date] AND [End_Date]
GROUP BY 
    sd.land_id;
